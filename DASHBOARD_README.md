# Dashboard - Личный кабинет пользователя

## Описание

Страница `dashboard.html` теперь полностью интегрирована с базой данных Django и отображает настоящие данные пользователя вместо статических данных.

## Основные изменения

### 1. Интеграция с базой данных
- **Профиль пользователя**: Отображает реальные данные из модели `User`
- **Статистика**: Показывает актуальное количество отзывов и потраченную сумму
- **Отзывы**: Отображает все отзывы пользователя с данными из БД
- **Бронирования**: Показывает все бронирования пользователя
- **Настройки**: Интегрированы с моделью `UserSettings`

### 2. Новые функции
- **Вкладка "Бронирования"**: Отдельная вкладка для просмотра всех бронирований
- **AJAX-обновление настроек**: Переключатели уведомлений работают без перезагрузки страницы
- **Динамические данные**: Все данные загружаются из базы данных в реальном времени

### 3. Структура данных

#### Модели, используемые в dashboard:
- `User` - основная информация о пользователе
- `Review` - отзывы пользователя
- `Booking` - бронирования пользователя
- `Favorite` - избранные элементы
- `UserSettings` - настройки пользователя
- `Excursion` - информация об экскурсиях
- `Country`, `City` - географическая информация

#### Данные, отображаемые на dashboard:
- **Профиль**: имя, email, телефон, аватар
- **Статистика**: количество отзывов, потраченная сумма
- **Отзывы**: название экскурсии, рейтинг, текст, дата
- **Бронирования**: название экскурсии, статус, дата, количество человек, стоимость
- **Настройки**: email/push уведомления

## Техническая реализация

### 1. View (dashboard_view)
```python
@login_required
def dashboard_view(request):
    # Обработка POST-запросов для обновления настроек
    if request.method == 'POST':
        # AJAX-обработка обновления настроек
        
    # Получение данных пользователя
    user_reviews = Review.objects.filter(user=request.user)
    user_bookings = Booking.objects.filter(user=request.user)
    total_spent = user_bookings.aggregate(total=Sum('total_price'))
    
    # Передача данных в шаблон
    context = {
        'user': request.user,
        'all_user_reviews': user_reviews,
        'all_user_bookings': user_bookings,
        'total_spent': total_spent,
        # ... другие данные
    }
```

### 2. Шаблон (dashboard.html)
- Использует Django Template Language для отображения данных
- Динамическое отображение отзывов и бронирований
- AJAX-запросы для обновления настроек
- Адаптивный дизайн для мобильных устройств

### 3. JavaScript функциональность
- Переключение между вкладками
- AJAX-обновление настроек уведомлений
- Toast-уведомления для обратной связи

## Использование

### 1. Доступ к dashboard
```
URL: /dashboard/
Требует: Авторизация пользователя
```

### 2. Навигация
- **Мои отзывы**: Просмотр всех отзывов пользователя
- **Бронирования**: Просмотр всех бронирований
- **Настройки**: Управление профилем и уведомлениями

### 3. Обновление настроек
- Переключатели уведомлений обновляются в реальном времени
- Изменения сохраняются в базе данных
- Обратная связь через toast-уведомления

## Требования

### 1. Django модели
- Все необходимые модели должны быть созданы и применены
- Миграции должны быть выполнены

### 2. Пользователи
- Пользователи должны быть зарегистрированы в системе
- Модель `UserSettings` создается автоматически при первом посещении

### 3. Данные
- Для отображения отзывов нужны экскурсии и отзывы в БД
- Для отображения бронирований нужны экскурсии и бронирования в БД

## Тестирование

### 1. Проверка данных
```python
# В Django shell
from selexia_travel.models import User, Review, Booking, UserSettings

# Проверка пользователей
users = User.objects.all()
print(f"Пользователей: {users.count()}")

# Проверка отзывов
reviews = Review.objects.all()
print(f"Отзывов: {reviews.count()}")

# Проверка бронирований
bookings = Booking.objects.all()
print(f"Бронирований: {bookings.count()}")
```

### 2. Проверка dashboard
1. Войти в систему под пользователем
2. Перейти на `/dashboard/`
3. Проверить отображение данных
4. Протестировать переключение вкладок
5. Проверить работу настроек уведомлений

## Возможные улучшения

### 1. Дополнительная статистика
- Графики активности по месяцам
- Популярные направления
- История путешествий

### 2. Интеграция с внешними сервисами
- Google Calendar для бронирований
- Email-уведомления о статусе
- Push-уведомления

### 3. Мобильное приложение
- API для мобильного приложения
- Push-уведомления
- Офлайн-режим

## Устранение неполадок

### 1. Пустой dashboard
- Проверить наличие данных в БД
- Проверить авторизацию пользователя
- Проверить права доступа

### 2. Ошибки при обновлении настроек
- Проверить CSRF-токен
- Проверить логи Django
- Проверить модель UserSettings

### 3. Проблемы с изображениями
- Проверить настройки MEDIA_URL и MEDIA_ROOT
- Проверить права доступа к папке media
- Проверить наличие изображений в БД

## Заключение

Dashboard теперь полностью интегрирован с базой данных Django и предоставляет пользователям актуальную информацию об их активности на платформе. Все данные загружаются динамически, а настройки обновляются в реальном времени без перезагрузки страницы.
